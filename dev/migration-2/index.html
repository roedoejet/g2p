
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../studio/">
      
      
        <link rel="next" href="../package/">
      
      
      <link rel="icon" href="../favicon-32x32.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Migrating from g2p 1.x - Gᵢ2Pᵢ Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#migrating-from-g2p-1x" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://roedoejet.github.io/g2p/" title="Gᵢ2Pᵢ Documentation" class="md-header__button md-logo" aria-label="Gᵢ2Pᵢ Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Gᵢ2Pᵢ Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Migrating from g2p 1.x
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://roedoejet.github.io/g2p/" title="Gᵢ2Pᵢ Documentation" class="md-nav__button md-logo" aria-label="Gᵢ2Pᵢ Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Gᵢ2Pᵢ Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to contribute
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../studio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using the g2p studio
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Migrating from g2p 1.x
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Migrating from g2p 1.x
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mapping-configurations-have-changed-for-the-better" class="md-nav__link">
    <span class="md-ellipsis">
      Mapping configurations have changed (for the better)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submodules-of-g2p-must-be-imported-explicitly" class="md-nav__link">
    <span class="md-ellipsis">
      Submodules of g2p must be imported explicitly
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mappings-and-rules-use-properties-to-access-their-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Mappings and rules use properties to access their fields
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#some-cli-commands-no-longer-exist" class="md-nav__link">
    <span class="md-ellipsis">
      Some CLI commands no longer exist
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../package/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Package
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Command Line
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mapping-configurations-have-changed-for-the-better" class="md-nav__link">
    <span class="md-ellipsis">
      Mapping configurations have changed (for the better)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submodules-of-g2p-must-be-imported-explicitly" class="md-nav__link">
    <span class="md-ellipsis">
      Submodules of g2p must be imported explicitly
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mappings-and-rules-use-properties-to-access-their-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Mappings and rules use properties to access their fields
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#some-cli-commands-no-longer-exist" class="md-nav__link">
    <span class="md-ellipsis">
      Some CLI commands no longer exist
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="migrating-from-g2p-1x">Migrating from <code>g2p</code> 1.x<a class="headerlink" href="#migrating-from-g2p-1x" title="Permanent link">&para;</a></h1>
<p>The <code>g2p</code> 2.0 release introduces a number of improvements and changes
which, unfortunately, are incompatible with mappings and Python code
written for the previous version.  We have tried to describe them here
with the changes you will need to make to your code and data.</p>
<h2 id="mapping-configurations-have-changed-for-the-better">Mapping configurations have changed (for the better)<a class="headerlink" href="#mapping-configurations-have-changed-for-the-better" title="Permanent link">&para;</a></h2>
<p>The configurations for mappings (which you'll find in
<code>g2p/mappings/langs/*/config-g2p.yaml</code>) are now validated with a <a href="https://raw.githubusercontent.com/roedoejet/g2p/main/g2p/mappings/.schema/g2p-config-schema-2.0.json">YAML
Schema</a>.
If you use an editor like <a href="https://code.visualstudio.com/">Visual Studio
Code</a> with the <a href="https://marketplace.visualstudio.com/items?itemName=redhat.vscode-yaml">YAML
extension</a>,
the names of fields will be autocompleted and some warnings will be
shown for possible values.  This also works with <a href="https://www.gnu.org/software/emacs/">GNU
Emacs</a> using
<a href="https://joaotavora.github.io/eglot/">Eglot</a> or
<a href="https://emacs-lsp.github.io/lsp-mode/">lsp-mode</a> and any other editor
that supports the <a href="https://microsoft.github.io/language-server-protocol/">Language Server
Protocol</a>
and/or <a href="https://www.schemastore.org/json/">SchemaStore</a>.  Some
varieties of VIM are known to work, for instance.</p>
<p>In order for this magic to work, we needed to give the configuration
files a somewhat more meaningful name than <code>config.yaml</code>, so they must
now be called <code>config-g2p.yaml</code>.  In addition some fields have changed
names to reflect the fact that they refer to <em>files</em> and not the
actual rules themselves:</p>
<ul>
<li><code>mapping</code> is now <code>rules_path</code></li>
<li><code>abbreviations</code> is now <code>abbreviations_path</code></li>
</ul>
<p>The mappings themselves should be compatible with the previous
version, please let us know if you encounter any problems.</p>
<h2 id="submodules-of-g2p-must-be-imported-explicitly">Submodules of <code>g2p</code> must be imported explicitly<a class="headerlink" href="#submodules-of-g2p-must-be-imported-explicitly" title="Permanent link">&para;</a></h2>
<p>Previously, when you called <code>import g2p</code>, it imported absolutely
everything, which caused the command-line interface (and probably your
program too) to start up very, very slowly.</p>
<p>If you simply use the public and documented <code>make_g2p</code> and
<code>make_tokenizer</code> APIs, this will not change anything, but if you
relied on internal classes and functions from <code>g2p.mappings</code>,
<code>g2p.transducer</code>, etc, then you can no longer depend on them being
also accessible in the top-level <code>g2p</code> package.  For example, you will
need to make this sort of change:</p>
<div class="highlight"><pre><span></span><code><span class="gd">- from g2p import Mapping, Transducer</span>
<span class="gi">+ from g2p.mappings import Mapping</span>
<span class="gi">+ from g2p.transducer import Transducer</span>
</code></pre></div>
<blockquote>
<p><strong>NOTE</strong> These are not public APIs, and are subject to further
changes.  This guide is provided as a courtesy to anyone who may have
been using them and should not be construed as public API documentation.</p>
</blockquote>
<h2 id="mappings-and-rules-use-properties-to-access-their-fields">Mappings and rules use properties to access their fields<a class="headerlink" href="#mappings-and-rules-use-properties-to-access-their-fields" title="Permanent link">&para;</a></h2>
<p>Along the same lines, access to the internal structure of rule-based
mappings has changed considerably (and for the better) due to the use
of <a href="https://docs.pydantic.dev/latest/">Pydantic</a>.  This means,
however, that you can no longer treat them as the simple dictionaries
that they used to be, since they are no longer that.  Instead, use
properties, which correspond to the names used in <code>config-g2p.yaml</code>.</p>
<p>For example, you can access the <code>case_sensitive</code> flag using the
property of the same name (note also that you can no longer construct
a <code>Mapping</code> by simply passing the name of the file):</p>
<div class="highlight"><pre><span></span><code><span class="n">mapping</span> <span class="o">=</span> <span class="n">Mapping</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="s2">&quot;path/to/some/config-g2p.yaml&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Case sensitive?&quot;</span><span class="p">,</span> <span class="n">mapping</span><span class="o">.</span><span class="n">case_sensitive</span><span class="p">)</span>
</code></pre></div>
<p>To iterate over the rules in a mapping, you now use the <code>rules</code>
property instead of the <code>mapping_data</code> field.  The rules themselves
now also use properties for access, which do not entirely correspond
to the names used in the JSON/YAML definition, because <code>in</code>, for example,
is a reserved word in Python.  So for instance you would make this
change:</p>
<div class="highlight"><pre><span></span><code><span class="gd">- for rule in mapping[&quot;mapping_data&quot;]:</span>
<span class="gd">-     print(&quot;Rule maps&quot;, rule[&quot;in&quot;], &quot;to&quot;, rule[&quot;out&quot;])</span>
<span class="gi">+ for rule in mapping.rules:</span>
<span class="gi">+     print(&quot;Rule maps&quot;, rule.rule_input, &quot;to&quot;, rule.rule_output)</span>
</code></pre></div>
<blockquote>
<p><strong>NOTE</strong>: These are not public APIs, and are subject to further
changes.  This guide is provided as a courtesy to anyone who may have
been using them and should not be construed as public API documentation.</p>
</blockquote>
<h2 id="some-cli-commands-no-longer-exist">Some CLI commands no longer exist<a class="headerlink" href="#some-cli-commands-no-longer-exist" title="Permanent link">&para;</a></h2>
<p>Several commands for the <code>g2p</code> command-line have been removed:</p>
<ul>
<li>run</li>
<li>routes</li>
<li>shell</li>
</ul>
<p>To run the <code>g2p</code> API server and G2P Studio, you can use:</p>
<pre><code>python run_studio.py
</code></pre>
<p>It does not seem that any equivalents of <code>routes</code> or <code>shell</code> exist.</p>







  
  






<h2 id="__comments">Comments</h2>
<!-- Insert generated snippet here -->
<script src="https://giscus.app/client.js" data-repo="roedoejet/g2p" data-repo-id="MDEwOlJlcG9zaXRvcnkxODU0NzczMDA=" data-category="Q&A" data-category-id="DIC_kwDOCw4otM4CZIZp" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="1"
    data-input-position="bottom" data-theme="preferred_color_scheme" data-lang="en" crossorigin="anonymous" async>
</script>
<!-- Synchronize Giscus theme with palette -->
<script>
    var giscus = document.querySelector("script[src*=giscus]")

    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate" ? "dark" : "light"
        giscus.setAttribute("data-theme", theme)
    }

    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function() {
        var ref = document.querySelector("[data-md-component=palette]")
        ref.addEventListener("change", function() {
            var palette = __md_get("__palette")
            if (palette && typeof palette.color === "object") {
                var theme = palette.color.scheme === "slate" ? "dark" : "light"

                /* Instruct Giscus to change theme */
                var frame = document.querySelector(".giscus-frame")
                frame.contentWindow.postMessage({
                        giscus: {
                            setConfig: {
                                theme
                            }
                        }
                    },
                    "https://giscus.app"
                )
            }
        })
    })
</script>

                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../studio/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Using the g2p studio">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Using the g2p studio
              </div>
            </div>
          </a>
        
        
          
          <a href="../package/" class="md-footer__link md-footer__link--next" aria-label="Next: Package">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Package
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.code.select", "announce.dismiss", "navigation.footer"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>